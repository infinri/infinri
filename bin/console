#!/usr/bin/env php
<?php
/**
 * Console Application Entry Point
 */

declare(strict_types=1);

use Symfony\Component\Console\Application;
use Infinri\Core\Console\CommandLoader;
use Infinri\Core\Model\Module\ModuleManager;
use Infinri\Core\Model\Setup\SchemaSetup;
use Infinri\Core\Console\Command\SetupUpgradeCommand;

/**
 * Infinri Console Application
 * 
 * CLI tool for managing the Infinri framework
 * 
 * Usage:
 *   php bin/console [command] [options]
 *   ./bin/console [command] [options]
 * 
 * Examples:
 *   bin/console list
 *   bin/console cache:clear
 *   bin/console module:list
 */

// Bootstrap the application
require __DIR__ . '/../app/bootstrap.php';

// Initialize application
$frontController = initApplication();

// Get ObjectManager
$objectManager = getObjectManager();

// Create console application
$application = new Application('Infinri Framework', '1.0.0');

// Get dependencies for setup command
$moduleManager = $objectManager->get(ModuleManager::class);
$schemaSetup = $objectManager->get(SchemaSetup::class);

// Load commands from command loader
$commandLoader = new CommandLoader();
$commands = $commandLoader->loadCommands();

// Add setup:upgrade command with proper dependencies
$commands[] = new SetupUpgradeCommand($moduleManager, $schemaSetup);

// Register all commands
$application->addCommands($commands);

// Run the application
$application->run();
