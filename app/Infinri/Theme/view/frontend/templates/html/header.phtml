<?php
/**
 * Header Template
 * 
 * @var \Infinri\Core\Block\Template $block
 * @var \Infinri\Theme\ViewModel\Header $viewModel
 */
$viewModel = null;

try {
    $viewModel = $block->getViewModel();
} catch (\Throwable $e) {
    // Fallback gracefully if we cannot resolve the view model
    $viewModel = null;
}
?>
<header class="header" role="banner">
    <?php if ($viewModel && method_exists($viewModel, 'getLogoUrl')): ?>
        <div class="header-container container">
            <div class="header-logo">
                <a href="<?= $block->escapeUrl($viewModel->getLogoUrl()) ?>" 
                   class="logo" 
                   title="<?= $block->escapeHtmlAttr('Home') ?>">
                    <img src="<?= $block->escapeUrl($viewModel->getLogo()) ?>" 
                         alt="<?= $block->escapeHtmlAttr('Infinri Logo') ?>"
                         class="logo-image">
                </a>
            </div>
            
            <nav class="header-navigation" role="navigation" aria-label="Main navigation">
                <button class="nav-toggle" 
                        type="button" 
                        aria-label="<?= $block->escapeHtmlAttr($viewModel->getMobileMenuLabel()) ?>"
                        aria-expanded="false"
                        aria-controls="main-nav">
                    <span class="nav-toggle-icon"></span>
                </button>
                
                <ul class="nav-menu" id="main-nav">
                    <?php foreach ($viewModel->getNavigation() as $item): ?>
                        <li class="nav-item <?= $item['active'] ? 'active' : '' ?>">
                            <a href="<?= $block->escapeUrl($item['url']) ?>" 
                               class="nav-link <?= $item['active'] ? 'active' : '' ?>">
                                <?= $block->escapeHtml($item['title']) ?>
                            </a>
                            <?php if (!empty($item['children'])): ?>
                                <ul class="nav-submenu">
                                    <?php foreach ($item['children'] as $child): ?>
                                        <li class="nav-subitem <?= $child['active'] ? 'active' : '' ?>">
                                            <a href="<?= $block->escapeUrl($child['url']) ?>" 
                                               class="nav-sublink <?= $child['active'] ? 'active' : '' ?>">
                                                <?= $block->escapeHtml($child['title']) ?>
                                            </a>
                                        </li>
                                    <?php endforeach; ?>
                                </ul>
                            <?php endif; ?>
                        </li>
                    <?php endforeach; ?>
                </ul>
            </nav>
            
            <?php if ($viewModel->isSearchEnabled()): ?>
                <div class="header-search">
                    <form action="<?= $block->escapeUrl($viewModel->getSearchUrl()) ?>" 
                          method="get" 
                          class="search-form"
                          role="search">
                        <input type="search" 
                               name="q" 
                               class="search-input" 
                               placeholder="<?= $block->escapeHtmlAttr('Search...') ?>"
                               aria-label="<?= $block->escapeHtmlAttr('Search') ?>">
                        <button type="submit" 
                                class="search-button"
                                aria-label="<?= $block->escapeHtmlAttr('Submit search') ?>">
                            <span class="search-icon">üîç</span>
                        </button>
                    </form>
                </div>
            <?php endif; ?>
        </div>
    <?php else: ?>
        <div class="header-content">
            <div class="logo">
                <a href="/" title="Infinri">
                    <span class="logo-text">Infinri</span>
                </a>
            </div>
            
            <nav class="main-navigation">
                <ul class="nav-list">
                    <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                    <li class="nav-item"><a href="/about" class="nav-link">About</a></li>
                    <li class="nav-item"><a href="/contact" class="nav-link">Contact</a></li>
                </ul>
            </nav>
        </div>
    <?php endif; ?>
</header>
