<?php
/**
 * Admin Menu Template - Magento Style
 * 
 * @var \Infinri\Admin\Block\Menu $block
 */

// Recursive function to render menu items
// Section headers (items without URL but with children) are always expanded
function renderMenuItem($item, $block, $level = 0) {
    $hasChildren = $block->hasChildren($item);
    $isActive = $block->isActive($item);
    $hasUrl = !empty($item['url']);
    $isTopLevel = $level === 0;
    $isSectionHeader = !$hasUrl && $hasChildren && $level > 0;
    
    $classes = ['admin-menu-item'];
    if ($isActive) $classes[] = 'active';
    if ($hasChildren) $classes[] = 'has-children';
    if ($isSectionHeader) $classes[] = 'section-header';
    ?>
    <li class="<?= implode(' ', $classes) ?>">
        <?php if ($hasUrl): ?>
            <!-- Clickable menu item -->
            <a href="<?= $block->escapeHtml($item['url']) ?>">
                <?php if (!empty($item['icon']) && $isTopLevel): ?>
                    <span class="menu-icon"><?= $block->escapeHtml($item['icon']) ?></span>
                <?php endif; ?>
                <span class="menu-text"><?= $block->escapeHtml($item['title']) ?></span>
            </a>
        <?php elseif ($isSectionHeader): ?>
            <!-- Section header (non-clickable label) -->
            <div class="menu-section-label">
                <span class="menu-text"><?= $block->escapeHtml($item['title']) ?></span>
            </div>
        <?php else: ?>
            <!-- Top-level collapsible item -->
            <div class="menu-header">
                <?php if (!empty($item['icon']) && $isTopLevel): ?>
                    <span class="menu-icon"><?= $block->escapeHtml($item['icon']) ?></span>
                <?php endif; ?>
                <span class="menu-text"><?= $block->escapeHtml($item['title']) ?></span>
                <?php if ($hasChildren): ?>
                    <span class="menu-arrow">â–¼</span>
                <?php endif; ?>
            </div>
        <?php endif; ?>
        
        <?php if ($hasChildren): ?>
            <!-- Always show children for section headers, otherwise use submenu behavior -->
            <ul class="admin-submenu <?= $isSectionHeader ? 'always-visible' : '' ?> <?= $isActive ? 'active' : '' ?>">
                <?php foreach ($item['children'] as $child): ?>
                    <?php renderMenuItem($child, $block, $level + 1); ?>
                <?php endforeach; ?>
            </ul>
        <?php endif; ?>
    </li>
    <?php
}

$menuItems = $block->getMenuItems();
?>
<nav class="admin-navigation">
    <ul class="admin-menu">
        <?php foreach ($menuItems as $item): ?>
            <?php renderMenuItem($item, $block, 0); ?>
        <?php endforeach; ?>
    </ul>
</nav>
